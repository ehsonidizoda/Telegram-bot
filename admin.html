<?php
session_start();

$login = 'admin';
$password = 'vipaccess';

// Обработка выхода
if (isset($_GET['logout'])) {
    session_destroy();
    header("Location: admin.php");
    exit;
}

// Обработка авторизации
if (isset($_POST['auth'])) {
    if ($_POST['login'] === $login && $_POST['password'] === $password) {
        $_SESSION['auth'] = true;
    } else {
        $error = "Неверный логин или пароль!";
    }
}

// Форма входа
if (!isset($_SESSION['auth'])):
?>
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Вход в админку</title>
</head>
<body>
  <form method="POST" style="max-width:300px;margin:100px auto;text-align:center;">
    <h2>Вход в админку</h2>
    <?php if (isset($error)) echo "<p style='color:red;'>$error</p>"; ?>
    <input type="text" name="login" placeholder="Логин" required><br><br>
    <input type="password" name="password" placeholder="Пароль" required><br><br>
    <button type="submit" name="auth">Войти</button>
  </form>
</body>
</html>
<?php
exit;
endif;
?>

<!-- Панель администратора -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Админ-панель</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; padding: 20px; }
    .card { background: #1a1a1a; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 0 10px #ff2f8b; }
    a { color: #ff2f8b; }
    .logout { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Заявки пользователей</h2>
  <div id="list">Загрузка...</div>
  <div class="logout">
    <a href="?logout=true">Выйти</a>
  </div>

  <script>
    fetch('data/requests.json')
      .then(r => r.json())
      .then(data => {
        const container = document.getElementById('list');
        container.innerHTML = '';
        data.reverse().forEach(req => {
          container.innerHTML += `
            <div class="card">
              <strong>${req.name}</strong> | ${req.telegram}<br>
              <small>${req.timestamp}</small><br>
              ${req.comment ? `<em>${req.comment}</em><br>` : ''}
              <a href="uploads/${req.file}" target="_blank">Чек</a>
            </div>
          `;
        });
      });
  </script>
</body>
</html>