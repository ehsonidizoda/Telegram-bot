<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VIP Access 18+</title>
  <style>
    :root {
      --primary: #ff0066;
      --bg: #1a1a1a;
      --text: #ffffff;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .age-gate {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .plan-card {
      background: #2a2a2a;
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      cursor: pointer;
      transition: transform 0.3s;
      border: 2px solid transparent;
    }

    .plan-card.selected {
      border-color: var(--primary);
    }

    .btn {
      background: var(--primary);
      color: white;
      padding: 15px 30px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      max-width: 300px;
      margin: 20px auto;
      display: block;
    }

    .hidden {
      display: none;
    }

    .payment-details {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
    }

    .loader {
      border: 4px solid #333;
      border-top-color: var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ -->
  <div class="age-gate" id="ageGate">
    <h2>–í–ù–ò–ú–ê–ù–ò–ï! –ö–æ–Ω—Ç–µ–Ω—Ç 18+</h2>
    <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–∏–µ</p>
    <button class="btn" onclick="confirmAge()">–ú–Ω–µ –µ—Å—Ç—å 18 –ª–µ—Ç</button>
    <button class="btn" onclick="window.close()">–í—ã–π—Ç–∏</button>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
  <div class="container" id="mainApp" class="hidden">
    <h1>üîû VIP –î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É</h1>
    
    <!-- –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ -->
    <div id="planSelection">
      <div class="plan-card" onclick="selectPlan('1d', 200)">
        <h3>24 —á–∞—Å–∞ –¥–æ—Å—Ç—É–ø–∞</h3>
        <p>‚ñ∂Ô∏è –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ 1 –¥–µ–Ω—å</p>
        <p>üî• –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</p>
        <h2>200‚ÇΩ</h2>
      </div>
      
      <div class="plan-card" onclick="selectPlan('1m', 400)">
        <h3>–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h3>
        <p>‚ñ∂Ô∏è –î–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω–µ–π</p>
        <p>üéÅ –ë–æ–Ω—É—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</p>
        <h2>400‚ÇΩ</h2>
      </div>
      
      <div class="plan-card" onclick="selectPlan('forever', 600)">
        <h3>–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø</h3>
        <p>‚ñ∂Ô∏è –í–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø</p>
        <p>üëë –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</p>
        <h2>600‚ÇΩ</h2>
      </div>
    </div>

    <!-- –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã -->
    <div id="paymentDetails" class="hidden">
      <div class="payment-details">
        <h3>üí≥ –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã</h3>
        <p>–ë–∞–Ω–∫: –¢–∏–Ω—å–∫–æ—Ñ—Ñ</p>
        <p>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: <code>5536 9138 2357 8542</code></p>
        <p>–°—É–º–º–∞: <span id="paymentAmount">‚ÇΩ</span></p>
        <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: <strong id="paymentComment"></strong></p>
        <p style="color: var(--primary);">‚ùó –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!</p>
      </div>
      
      <button class="btn" onclick="verifyPayment()">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
      <div id="loader" class="loader hidden"></div>
      <p id="errorMessage" style="color: #ff4444; display: none;"></p>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    let selectedPlan = null;
    let paymentComment = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      tg.expand();
      tg.BackButton.hide();
      checkAgeVerification();
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
    function confirmAge() {
      localStorage.setItem('ageVerified', 'true');
      document.getElementById('ageGate').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
    }

    function checkAgeVerification() {
      if (!localStorage.getItem('ageVerified')) {
        document.getElementById('ageGate').classList.remove('hidden');
      }
    }

    // –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞
    function selectPlan(planId, amount) {
      selectedPlan = { planId, amount };
      paymentComment = `VIP-${Date.now()}-${tg.initDataUnsafe.user?.id || 'anon'}`;
      
      document.getElementById('planSelection').classList.add('hidden');
      document.getElementById('paymentDetails').classList.remove('hidden');
      document.getElementById('paymentAmount').textContent = `${amount}‚ÇΩ`;
      document.getElementById('paymentComment').textContent = paymentComment;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã
    async function verifyPayment() {
      const loader = document.getElementById('loader');
      const error = document.getElementById('errorMessage');
      
      loader.classList.remove('hidden');
      error.style.display = 'none';

      try {
        // –≠–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
        const response = await fetch(`/api/check-payment?comment=${paymentComment}`);
        const data = await response.json();

        if (data.status === 'paid') {
          tg.sendData(JSON.stringify({
            type: 'vip_payment',
            user: tg.initDataUnsafe.user,
            plan: selectedPlan,
            comment: paymentComment
          }));
          
          window.location.href = `https://t.me/${tg.initDataUnsafe.bot.username}?start=${paymentComment}`;
          setTimeout(() => tg.close(), 2000);
        } else {
          error.textContent = '–û–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
          error.style.display = 'block';
        }
      } catch (error) {
        error.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
        error.style.display = 'block';
      } finally {
        loader.classList.add('hidden');
      }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    init();
  </script>
</body>
</html>