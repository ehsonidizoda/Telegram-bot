<!-- vip.html --><!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>VIP Доступ</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 40px; text-align: center; }
    .card { background: #1a1a1a; border-radius: 12px; padding: 20px; max-width: 400px; margin: auto; box-shadow: 0 0 12px #ff2f8b; }
    input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; background: #2a2a2a; color: #fff; }
    button { background: #ff2f8b; border: none; color: white; padding: 12px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    .notice { font-size: 13px; color: #aaa; margin-top: 12px; }
  </style>
</head>
<body>
<div class="card">
  <h3>Форма подтверждения оплаты</h3>
  <form action="send_check.php" method="POST" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Имя" required>
    <input type="text" name="telegram" placeholder="@username" required>
    <input type="file" name="check_file" accept="image/*,.pdf" required>
    <textarea name="comment" placeholder="Комментарий (необязательно)"></textarea>
    <button type="submit">Отправить заявку</button>
  </form>
  <p class="notice">После проверки мы свяжемся с вами в Telegram</p>
</div>
</body>
</html><?php
// send_check.php
$db = new PDO("sqlite:db.sqlite");
$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$db->exec("CREATE TABLE IF NOT EXISTS checks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT,
  telegram TEXT,
  comment TEXT,
  file TEXT,
  status TEXT DEFAULT 'pending',
  created_at TEXT
)");

$name = $_POST['name'] ?? '';
$telegram = $_POST['telegram'] ?? '';
$comment = $_POST['comment'] ?? '';
$created_at = date('Y-m-d H:i:s');

if (isset($_FILES['check_file'])) {
  $filename = basename($_FILES['check_file']['name']);
  $target = 'uploads/' . time() . '_' . $filename;
  move_uploaded_file($_FILES['check_file']['tmp_name'], $target);
  $stmt = $db->prepare("INSERT INTO checks (name, telegram, comment, file, created_at) VALUES (?, ?, ?, ?, ?)");
  $stmt->execute([$name, $telegram, $comment, $target, $created_at]);
  echo "<script>alert('✅ Заявка отправлена!'); window.location.href='vip.html';</script>";
} else {
  echo "<script>alert('❌ Ошибка: файл не загружен.'); window.history.back();</script>";
}
?>